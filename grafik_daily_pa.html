
<!DOCTYPE html>
<html>
<head>
    <title>Daily PA Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <h2>Daily PA Dashboard</h2>
    <label for="pitFilter">Filter by PIT:</label>
    <select id="pitFilter"></select>

    <label for="modelFilter">Filter by Model:</label>
    <select id="modelFilter"></select>

    <label for="unitFilter">Filter by Unit ID:</label>
    <select id="unitFilter"></select>

    <canvas id="paChart" width="800" height="400"></canvas>

    <h3>Upload JSON</h3>
    <input type="file" id="uploadJson" accept=".json">

    <h3>Download Filtered JSON</h3>
    <button onclick="downloadFilteredData()">Download</button>

    <script>
        let originalData = [];
        let filteredData = [];

        async function fetchData() {
            const response = await fetch('daily_pa_data.json');
            originalData = await response.json();
            populateFilters();
            updateChart();
        }

        function populateFilters() {
            const pits = [...new Set(originalData.map(d => d.PIT))];
            const models = [...new Set(originalData.map(d => d.Model))];
            const units = [...new Set(originalData.map(d => d.Unit_ID))];

            const pitSelect = document.getElementById("pitFilter");
            const modelSelect = document.getElementById("modelFilter");
            const unitSelect = document.getElementById("unitFilter");

            [pitSelect, modelSelect, unitSelect].forEach(select => {
                select.innerHTML = '<option value="">All</option>';
            });

            pits.forEach(p => pitSelect.innerHTML += `<option value="${p}">${p}</option>`);
            models.forEach(m => modelSelect.innerHTML += `<option value="${m}">${m}</option>`);
            units.forEach(u => unitSelect.innerHTML += `<option value="${u}">${u}</option>`);

            pitSelect.onchange = updateChart;
            modelSelect.onchange = updateChart;
            unitSelect.onchange = updateChart;
        }

        function updateChart() {
            const pit = document.getElementById("pitFilter").value;
            const model = document.getElementById("modelFilter").value;
            const unit = document.getElementById("unitFilter").value;

            filteredData = originalData.filter(d =>
                (pit === "" || d.PIT === pit) &&
                (model === "" || d.Model === model) &&
                (unit === "" || d.Unit_ID === unit)
            );

            const dates = filteredData.map(d => d.Date);
            const counts = dates.reduce((acc, date) => {
                acc[date] = (acc[date] || 0) + 1;
                return acc;
            }, {});

            const labels = Object.keys(counts);
            const data = Object.values(counts);

            const ctx = document.getElementById('paChart').getContext('2d');
            if (window.paChart) window.paChart.destroy();
            window.paChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Daily PA Count',
                        data: data,
                        borderColor: 'blue',
                        fill: false
                    }]
                }
            });
        }

        document.getElementById("uploadJson").addEventListener("change", function(event) {
            const file = event.target.files[0];
            const reader = new FileReader();
            reader.onload = function(e) {
                originalData = JSON.parse(e.target.result);
                populateFilters();
                updateChart();
            };
            reader.readAsText(file);
        });

        function downloadFilteredData() {
            const blob = new Blob([JSON.stringify(filteredData, null, 2)], { type: "application/json" });
            const url = URL.createObjectURL(blob);
            const a = document.createElement("a");
            a.href = url;
            a.download = "filtered_daily_pa_data.json";
            a.click();
            URL.revokeObjectURL(url);
        }

        fetchData();
    </script>
</body>
</html>
